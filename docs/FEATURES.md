# 기능 명세서

## 1. 사용자 (간단 인증)

### 1.1 로그인 (이름.확장자 형식)

**기능 설명**

- `이름.확장자` 형식으로 입력하면 로그인/회원가입 완료
- 예시: `liam.gg`, `player.123`, `david.dev`
- 기존 사용자(이름+확장자 조합)가 있으면 해당 사용자로 로그인
- 없으면 새 사용자 자동 생성
- 세션 정보는 localStorage에 저장 (userId, userName, userTag)

**입력 규칙**
| 항목 | 규칙 |
|------|------|
| 형식 | `이름.확장자` |
| 이름 길이 | 1~10자 |
| 확장자 길이 | 1~10자 |
| 허용 문자 | 영문, 숫자만 |
| 저장 형식 (이름) | 첫글자 대문자 + 나머지 소문자 (예: `Liam`) |
| 저장 형식 (확장자) | 전체 소문자 (예: `gg`) |
| 유니크 기준 | 이름 + 확장자 조합 |

**UI 요구사항**

- 카카오 스타일 로그인 화면 (노란색 배경)
- TALK 로고 (말풍선 모양)
- 입력 필드 1개 (placeholder: `이름.확장자 (예: liam.gg)`)
- 로그인 버튼 (입력 없으면 비활성화)
- 로딩 상태 표시
- 형식 오류 시 에러 메시지

### 1.2 로그아웃

**기능 설명**

- localStorage에서 userId, userName, userTag 모두 삭제
- 로그인 화면으로 이동

**로그아웃 위치**

- 채팅 목록 헤더 (LogOut 아이콘)
- 기록 페이지 헤더 (LogOut 아이콘)

---

## 2. 채팅 목록

### 2.1 탭 구분

**탭 종류**

- **내 채팅**: 내가 참여한 채팅방 목록 (톡다이어리 포함)
- **공개방**: 누구나 참여 가능한 공개 채팅방 목록

### 2.2 내 채팅 탭

**기능 설명**

- 사용자가 참여한 채팅방 목록 표시
- **톡다이어리가 최상단에 고정**
- 각 채팅방의 마지막 메시지 미리보기
- 읽지 않은 메시지 수 표시 (주황색 뱃지)
- 최신 메시지 순 정렬

**표시 정보**
| 항목 | 설명 |
|------|------|
| 채팅방 아이콘 | 노란색 사각형(둥근 모서리) + MessageCircle 아이콘 |
| 채팅방 이름 | 방 이름 |
| 멤버 수 | 참여 인원 |
| 마지막 메시지 | 최근 메시지 미리보기 |
| 시간 | 마지막 메시지 시간 (오늘/어제/요일/날짜) |
| 읽지 않은 수 | 주황색 뱃지로 표시 (99+ 제한) |

### 2.3 공개방 탭

**기능 설명**

- 모든 공개 채팅방 목록 표시
- 참여 여부와 관계없이 모두 표시
- 클릭 시 참여 또는 입장

### 2.4 채팅방 생성

**기능 설명**

- 사용자가 직접 새 채팅방 생성
- 채팅방 이름 입력 필수
- 생성 후 자동으로 해당 채팅방에 참여 및 입장

---

## 3. 채팅방

### 3.1 채팅방 입장

**기능 설명**

- 채팅 목록에서 채팅방 클릭 시 입장
- 이전 메시지 로드 (오래된 순)
- 읽지 않은 메시지 읽음 처리 (last_read_at 업데이트)
- 자동 스크롤 (최하단으로)

### 3.2 날짜 pill

**기능 설명**

- 날짜가 바뀔 때마다 날짜 구분선 표시
- 형식: `YYYY년 M월 D일 요일`
- 캘린더 아이콘 포함

### 3.3 메시지 표시

**메시지 스타일**

- 내 메시지: 우측 정렬, 노란색 배경
- 상대 메시지: 좌측 정렬, 흰색 배경
- 프로필 아이콘: 둥근 사각형 (rounded-2xl)

**메시지 그룹화**

- 동일 발신자의 연속 메시지는 첫 메시지만 아바타/이름 표시
- 동일 시간(분)의 연속 메시지는 마지막 메시지에만 시간 표시

### 3.4 메시지 전송

**기능 설명**

- 텍스트 메시지 입력 및 전송
- Enter 키로 전송
- 전송 버튼으로 전송 (Send 아이콘)

### 3.5 커스텀 스크롤바

**스타일**

- 너비 4px
- 둥근 모서리
- 투명 배경
- 연한 회색 thumb (호버 시 진해짐)

---

## 4. 하단 네비게이션

| 탭   | 아이콘        | 설명            |
| ---- | ------------- | --------------- |
| 채팅 | MessageCircle | 채팅 목록       |
| 기록 | Archive       | 톡다이어리 아카이브 |

**읽지 않은 메시지 뱃지**

- 채팅 탭에 읽지 않은 총 메시지 수 표시
- 주황색 뱃지 (99+ 제한)

---

## 5. 톡다이어리

하루하루 흘러가는 채팅 속에서 그날의 의미를 발견하고 기록할 수 있는 기능입니다.

### 5.1 톡다이어리 채팅방

**기능 설명**

- 채팅 목록 최상단에 고정 표시
- 전용 프로필 이미지 (`dairy_profile.png`) 사용
- 일반 채팅방과 분리되어 별도 페이지로 구현 (`TalkDiaryPage`)
- 메시지 입력 불가 (리포트만 수신)

**채팅 목록 표시**
| 항목 | 설명 |
|------|------|
| 프로필 | 톡다이어리 전용 이미지 |
| 이름 | "톡다이어리" |
| 미리보기 | "{userName}님, 오늘의 톡다이어리가 도착했어요." |
| 뱃지 | 새 리포트 시 "N" 표시 (숫자 대신) |

### 5.2 톡다이어리 알림

**기능 설명**

- 새 톡다이어리 도착 시 상단에 푸시 알림 스타일로 표시
- 1.5초 후 자동 사라짐
- 클릭 시 톡다이어리 페이지로 이동

**알림 UI**

- 흰색 배경, 둥근 모서리, 그림자
- 톡다이어리 프로필 이미지 + "톡다이어리" + 메시지

### 5.3 리포트 카드 (캐러셀)

3장의 카드를 가로 스와이프로 탐색

**캐러셀 설정**
| 항목 | 값 | 설명 |
|------|-----|------|
| 카드 너비 | 360px | 고정 너비 |
| 정렬 | center | 이전/다음 카드가 양쪽에 보임 |
| 가장자리 처리 | trimSnaps | 첫/마지막 카드는 가장자리 정렬 |
| 좌측 여백 | 12px | 프로필과 정렬 |
| 카드 간격 | 12px | gap-3 |

**레이아웃**
- 프로필 (아바타 + 이름): 상단 행
- 카드 캐러셀: 하단 행 (분리된 레이아웃)

**카드 1: 데일리 요약**
| 항목 | 설명 |
|------|------|
| 타이틀 | "M월 D일, 오늘의 톡다이어리가 도착했어요." |
| 요약 문구 | 하루를 감성적으로 요약하는 텍스트 |
| 오늘의 키워드 | 3개의 핑크 태그 |
| 오늘의 감정 날씨 | 감정 아이콘 + 감정 태그 |
| 최고의 티키타카 | 이모지 + 이름 |

**카드 2: 오늘의 특별한 대화**
| 항목 | 설명 |
|------|------|
| 타이틀 | "오늘의 특별한 대화를 확인해보세요." |
| 대화 목록 | 키워드 태그, 제목, 미리보기, 발신자 |
| 클릭 시 | 해당 채팅방으로 이동 |

**카드 3: AI 이미지**
| 항목 | 설명 |
|------|------|
| 이미지 | 정사각형 AI 생성 이미지 |
| 버튼 1 | "이미지 다운로드" (노란색) |
| 버튼 2 | "톡다이어리 전체보기" (흰색 테두리) |

### 5.4 톡다이어리 콘텐츠 구조

```typescript
interface DailyReportContent {
  dailySummary: {
    title: string                    // 타이틀
    summaryText: string              // 요약 문구
    keywords: string[]               // 오늘의 키워드 (3개)
    emotionWeather: string           // 오늘의 감정 날씨
    bestTikitaka: {                  // 최고의 티키타카
      name: string
      chatId?: string
    }
  }
  specialConversations: {
    keyword: string                  // 키워드 태그
    title: string                    // 대화 제목
    preview: string                  // 대화 미리보기
    senderName: string               // 발신자 이름
    chatId: string
    messageId?: string
  }[]
  aiImageSummary: {
    imageUrl: string | null          // AI 이미지 URL
  }
}
```

### 5.5 톡다이어리 전체보기 (TalkDiary)

톡다이어리 채팅방에서 "전체보기" 버튼을 누르거나, 리포트 카드의 특별한 대화에서 이동 시 진입

#### 5.5.1 홈탭

**월별 감정 캘린더**
| 항목 | 설명 |
|------|------|
| 년월 표시 | 중앙에 "YYYY.MM" 형식 |
| 네비게이션 | 좌우 화살표로 월 이동 |
| 요일 헤더 | 일(빨강) ~ 토(파랑) |
| 날짜 셀 | 날짜 숫자 + 감정 아이콘 |
| 오늘 표시 | 검은색 원형 배경 |
| 빈 날짜 | 점선 원형 표시 |

**이달의 티키타카 랭킹**
| 항목 | 설명 |
|------|------|
| 최대 인원 | 3명 |
| 순위 표시 | 메달 아이콘 (1등 금, 2등 은, 3등 동) |
| 프로필 | 이름 첫 글자 아바타 |
| 정보 | 이름, 티키타카 횟수 |
| 액션 | 선물하기 버튼 |

**키워드 컬렉션**
| 항목 | 설명 |
|------|------|
| 소스 | 해당 월의 모든 리포트 키워드 |
| 표시 개수 | 최대 10개 (랜덤 선택) |
| 스타일 | 해시 기반 일관된 색상 + 이모지 |

**AI 갤러리**
| 항목 | 설명 |
|------|------|
| 소스 | 해당 월의 모든 리포트 AI 이미지 |
| 전환 | 3초 간격 자동 슬라이드 |
| 효과 | 1초 크로스페이드 (부드러운 전환) |

#### 5.5.2 리포트탭

**주별 캘린더**
| 항목 | 설명 |
|------|------|
| 년월 표시 | 좌측에 "YYYY.MM" 형식 |
| 네비게이션 | 우측 좌우 화살표로 주 이동 |
| 요일 헤더 | 일(빨강) ~ 토(파랑) |
| 날짜 셀 | 날짜 숫자 + 감정 아이콘 |
| 선택 표시 | 검은색 원형 배경 |
| 빈 날짜 | 점선 원형 표시 |

**선택 날짜 리포트**
- 데일리 요약: 요약 문구, 키워드, 감정 날씨, 티키타카
- 특별한 대화: 키워드 태그, 제목, 미리보기 (클릭 시 채팅방 이동)
- AI 갤러리: AI 생성 이미지

**구분선**
- 캘린더와 리포트 사이, 각 섹션 사이에 연한 회색 구분선

---

## 6. UI/UX 요구사항

### 6.1 레이아웃

- 모바일 최적화 (max-width: 448px, mx-auto)
- 세로 전체 화면 (h-screen)
- 양쪽 테두리 (border-x)

### 6.2 색상

| 용도               | 색상   | 코드    |
| ------------------ | ------ | ------- |
| 카카오 노랑        | 노랑   | #FEE500 |
| 내 메시지 배경     | 노랑   | #FEE500 |
| 상대방 메시지 배경 | 흰색   | #FFFFFF |
| 채팅방 배경        | 하늘색 | #D0DDE8 |
| 읽지 않은 수       | 주황색 | #FF6B35 |

### 6.3 프로필 아이콘

- 채팅 목록: `rounded-3xl` (더 둥근 사각형)
- 채팅방/톡다이어리 내부: `rounded-2xl` (약간 덜 둥근 사각형)

### 6.4 톡다이어리 UI 스타일

| 요소 | border-radius | Tailwind |
|------|---------------|----------|
| 카드 | 12px | `rounded-xl` |
| 내부 박스/버튼 | 8px | `rounded-lg` |
| 태그/뱃지 | 전체 둥글게 | `rounded-full` |

**그림자**
- 카드 박스: `shadow-[0_0_12px_rgba(0,0,0,0.1)]`

**배경색**
- 카드 내부 박스: `#FAFAFA`
- 랭킹 아이템: `#F5F5F5`

---

## 7. 구현 상태

### 채팅 기능 (완료)

- ✅ 이름.확장자 로그인/회원가입
- ✅ 로그아웃
- ✅ 내 채팅방 / 공개 채팅방 목록 조회
- ✅ 채팅방 생성 및 참여
- ✅ 텍스트 메시지 전송/조회
- ✅ 실시간 메시지 수신
- ✅ 읽지 않은 메시지 수 표시
- ✅ 하단 네비게이션
- ✅ 날짜 pill
- ✅ 커스텀 스크롤바

### 톡다이어리 기능 (완료)

- ✅ 톡다이어리 채팅방 (채팅 목록 최상단 고정)
- ✅ 톡다이어리 채팅방 페이지 (프로필/카드 분리 레이아웃)
- ✅ 리포트 카드 UI (3장 캐러셀, 360px 고정 너비)
- ✅ 톡다이어리 알림 컴포넌트
- ✅ Supabase Realtime 톡다이어리 수신

### 톡다이어리 전체보기 (완료)

- ✅ 홈탭/리포트탭 전환
- ✅ 월별 감정 캘린더 (홈탭)
- ✅ 이달의 티키타카 랭킹 (홈탭)
- ✅ 키워드 컬렉션 (홈탭)
- ✅ AI 갤러리 크로스페이드 슬라이드쇼 (홈탭)
- ✅ 주별 캘린더 (리포트탭)
- ✅ 날짜별 리포트 상세 조회 (리포트탭)
- ✅ 특별한 대화에서 채팅방 이동

### 리포트 생성 흐름

- AI 서버에서 자동으로 리포트 생성 → Supabase DB 저장
- 클라이언트는 DB에서 리포트 조회 (AI 서버 직접 호출 없음)
- Supabase Realtime으로 새 리포트 도착 감지

### 제외

- ❌ 이미지/파일 전송
- ❌ 푸시 알림 (웹 푸시)
- ❌ 메시지 검색
- ❌ 프로필 수정
- ❌ 일기 직접 작성
