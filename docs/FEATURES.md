# 기능 명세서

## 1. 사용자 (간단 인증)

### 1.1 로그인 (이름.확장자 형식)

**기능 설명**

- `이름.확장자` 형식으로 입력하면 로그인/회원가입 완료
- 예시: `liam.gg`, `player.123`, `david.dev`
- 기존 사용자(이름+확장자 조합)가 있으면 해당 사용자로 로그인
- 없으면 새 사용자 자동 생성
- 세션 정보는 localStorage에 저장 (userId, userName, userTag)

**입력 규칙**
| 항목 | 규칙 |
|------|------|
| 형식 | `이름.확장자` |
| 이름 길이 | 1~10자 |
| 확장자 길이 | 1~10자 |
| 허용 문자 | 영문, 숫자만 |
| 저장 형식 (이름) | 첫글자 대문자 + 나머지 소문자 (예: `Liam`) |
| 저장 형식 (확장자) | 전체 소문자 (예: `gg`) |
| 유니크 기준 | 이름 + 확장자 조합 |

**UI 요구사항**

- 카카오 스타일 로그인 화면 (노란색 배경)
- TALK 로고 (말풍선 모양)
- 입력 필드 1개 (placeholder: `이름.확장자 (예: liam.gg)`)
- 로그인 버튼 (입력 없으면 비활성화)
- 로딩 상태 표시
- 형식 오류 시 에러 메시지

**흐름**

```
1. "liam.gg" 입력
2. "로그인" 버튼 클릭
3. 입력값 파싱: name="liam", tag="gg"
4. 변환: name="Liam", tag="gg"
5. DB에서 name='Liam' AND tag='gg' 검색
6. 있으면 → 해당 사용자 ID로 로그인
7. 없으면 → 새 사용자 생성 후 로그인
8. userId, userName, userTag를 localStorage에 저장
9. 채팅 목록으로 이동
```

### 1.2 로그아웃

**기능 설명**

- localStorage에서 userId, userName, userTag 모두 삭제
- 로그인 화면으로 이동

**로그아웃 위치**

- 채팅 목록 헤더 (LogOut 아이콘)
- 기록 페이지 헤더 (LogOut 아이콘)

---

## 2. 채팅 목록

### 2.1 탭 구분

**탭 종류**

- **내 채팅**: 내가 참여한 채팅방 목록
- **공개방**: 누구나 참여 가능한 공개 채팅방 목록

**탭 전환 시 동작**

- 탭 클릭 시 해당 데이터 새로고침

### 2.2 내 채팅 탭

**기능 설명**

- 사용자가 참여한 채팅방 목록 표시
- 각 채팅방의 마지막 메시지 미리보기
- 읽지 않은 메시지 수 표시 (주황색 뱃지)
- 최신 메시지 순 정렬

**표시 정보**
| 항목 | 설명 |
|------|------|
| 채팅방 아이콘 | 노란색 원 + MessageCircle 아이콘 |
| 채팅방 이름 | 방 이름 |
| 멤버 수 | 참여 인원 |
| 마지막 메시지 | 최근 메시지 미리보기 |
| 시간 | 마지막 메시지 시간 (오늘/어제/요일/날짜) |
| 읽지 않은 수 | 주황색 뱃지로 표시 (99+ 제한) |

### 2.3 공개방 탭

**기능 설명**

- 모든 공개 채팅방 목록 표시
- 참여 여부와 관계없이 모두 표시
- 클릭 시 참여 또는 입장

**표시 정보**
| 항목 | 설명 |
|------|------|
| 채팅방 아이콘 | 노란색 원 + MessageCircle 아이콘 |
| 채팅방 이름 | 방 이름 |
| 멤버 수 | 현재 참여 인원 |
| 참여 상태 | "참여중" (초록) 또는 "참여하기" (주황) 뱃지 |

### 2.4 채팅방 생성

**기능 설명**

- 사용자가 직접 새 채팅방 생성
- 채팅방 이름 입력 필수
- 생성 후 자동으로 해당 채팅방에 참여 및 입장

**UI 요구사항**

- 헤더에 "+" 버튼
- 채팅방 이름 입력 모달
- 취소/만들기 버튼

### 2.5 실시간 업데이트

**기능 설명**

- Supabase Realtime 구독
- 새 메시지 도착 시 목록 자동 갱신
- 마지막 메시지 및 시간 업데이트
- 읽지 않은 메시지 수 증가

---

## 3. 채팅방

### 3.1 채팅방 입장

**기능 설명**

- 채팅 목록에서 채팅방 클릭 시 입장
- 이전 메시지 로드 (오래된 순)
- 읽지 않은 메시지 읽음 처리 (last_read_at 업데이트)
- 자동 스크롤 (최하단으로)

### 3.2 채팅방 헤더

**표시 정보**

- 뒤로가기 버튼 (ChevronLeft)
- 채팅방 이름
- 멤버 수

### 3.3 메시지 조회

**표시 정보**
| 항목 | 설명 |
|------|------|
| 발신자 아바타 | 상대방 메시지만 (좌측, 회색 원 + 이름 첫글자) |
| 발신자 이름 | 상대방 메시지만 (아바타 옆) |
| 메시지 내용 | 텍스트 |
| 전송 시간 | 메시지 옆에 표시 (오전/오후 시:분) |

**메시지 스타일**

- 내 메시지: 우측 정렬, 노란색 배경
- 상대 메시지: 좌측 정렬, 흰색 배경

**메시지 그룹화**

- 동일 발신자의 연속 메시지는 첫 메시지만 아바타/이름 표시
- 동일 시간(분)의 연속 메시지는 마지막 메시지에만 시간 표시

### 3.4 메시지 전송

**기능 설명**

- 텍스트 메시지 입력 및 전송
- Enter 키로 전송
- 전송 버튼으로 전송 (Send 아이콘)
- 전송 후 입력창 초기화

**UI 요구사항**

- 입력창: 회색 둥근 모서리, placeholder "메시지 보내기"
- 전송 버튼: 항상 표시 (입력 없으면 비활성화)

### 3.5 실시간 메시지 수신

**기능 설명**

- Supabase Realtime으로 새 메시지 구독
- 다른 사용자가 보낸 메시지 실시간 수신
- 메시지 목록에 자동 추가
- 자동 스크롤 (최하단으로)

---

## 4. 하단 네비게이션

### 4.1 구성

| 탭   | 아이콘        | 설명            |
| ---- | ------------- | --------------- |
| 채팅 | MessageCircle | 채팅 목록       |
| 기록 | Archive       | 리포트 아카이브 |

**읽지 않은 메시지 뱃지**

- 채팅 탭에 읽지 않은 총 메시지 수 표시
- 주황색 뱃지 (99+ 제한)

---

## 5. Talk Diary (데일리 리포트)

하루하루 흘러가는 채팅 속에서 그날의 의미를 발견하고 기록할 수 있는 기능입니다.

### 5.1 톡다이어리 채팅방

**기능 설명**

- 사용자별 전용 "톡다이어리" 채팅방 자동 생성
- 로그인 시 자동으로 생성되어 채팅 목록 최상단에 고정 표시
- 리포트 메시지가 이 채팅방으로 전송됨
- 일반 채팅방과 구분되는 특별 아이콘 (Book) 사용

**특징**

| 항목 | 설명 |
|------|------|
| 채팅방 타입 | `talk_diary` (시스템 채팅방) |
| 소유자 | 사용자 본인 (1:1 관계) |
| 메시지 입력 | 비활성화 (리포트만 수신) |
| 나가기 | 불가 |

### 5.2 리포트 생성 및 수신

**기능 설명**

- AI 서버에서 리포트 생성 후 Supabase에 저장
- 클라이언트는 Supabase Realtime으로 `daily_reports` 테이블 INSERT 이벤트 구독
- 새 리포트 감지 시 톡다이어리 채팅방에 리포트 카드 메시지 자동 표시

**리포트 생성 흐름**

```
1. AI 서버에서 사용자의 당일 채팅 분석
2. 리포트 생성 (요약, 감정 분석, 이미지 생성)
3. Supabase daily_reports 테이블에 INSERT
4. 클라이언트에서 Realtime으로 감지
5. 톡다이어리 채팅방에 리포트 카드 메시지 추가
```

### 5.3 리포트 내용

**리포트 구성 요소**

| 항목 | 설명 |
|------|------|
| 그날의 요약 | AI가 생성한 하루 채팅 요약 텍스트 |
| 기억할만한 채팅 | 주요 대화 하이라이트 (채팅방 이동 링크 포함) |
| 감정 키워드 | 하루의 감정을 나타내는 키워드 태그 |
| 요약 이미지 | AI가 생성한 하루를 대표하는 이미지 |

**리포트 카드 UI**

- 톡다이어리 채팅방에서 특별한 카드 형태로 표시
- 일반 텍스트 메시지와 구분되는 레이아웃
- "기억할만한 채팅" 클릭 시 해당 채팅방으로 이동

### 5.4 기록 탭 (Archive)

**기능 설명**

- 하단 네비게이션 "기록" 탭에서 조회
- 받았던 리포트들을 날짜별로 모아보기
- 최신순 정렬
- 월별 그룹핑 UI

**표시 정보**

| 항목 | 설명 |
|------|------|
| 리포트 날짜 | YYYY년 MM월 DD일 |
| 요약 미리보기 | 리포트 요약 텍스트 일부 |
| 감정 키워드 | 태그 형태로 표시 |
| 썸네일 | 요약 이미지 미리보기 (있는 경우) |

### 5.5 리포트 상세

**기능 설명**

- Archive에서 리포트 클릭 시 상세 보기
- 전체 요약, 감정 키워드, 기억할만한 채팅 목록, 이미지 표시
- "기억할만한 채팅" 클릭 시 해당 채팅방으로 이동

---

## 6. UI/UX 요구사항

### 6.1 레이아웃

- 모바일 최적화 (max-width: 448px, mx-auto)
- 세로 전체 화면 (h-screen)
- 양쪽 테두리 (border-x)

### 6.2 색상

| 용도               | 색상   | 코드    |
| ------------------ | ------ | ------- |
| 카카오 노랑        | 노랑   | #FEE500 |
| 내 메시지 배경     | 노랑   | #FEE500 |
| 상대방 메시지 배경 | 흰색   | #FFFFFF |
| 채팅방 배경        | 하늘색 | #B2C7D9 |
| 읽지 않은 수       | 주황색 | #FF6B35 |

### 6.3 아이콘

- Lucide React 사용
- 주요 아이콘: MessageCircle, Archive, Plus, X, LogOut, ChevronLeft, Send

---

## 7. 구현 상태

### 채팅 기능 (완료)

- ✅ 이름.확장자 로그인/회원가입
- ✅ 로그아웃
- ✅ 내 채팅방 / 공개 채팅방 목록 조회
- ✅ 채팅방 생성 및 참여
- ✅ 텍스트 메시지 전송/조회
- ✅ 실시간 메시지 수신
- ✅ 읽지 않은 메시지 수 표시
- ✅ 하단 네비게이션

### Talk Diary 기능 (예정)

- ⏳ 톡다이어리 채팅방 (사용자별 자동 생성)
- ⏳ 리포트 카드 메시지 UI
- ⏳ Supabase Realtime 리포트 수신
- ⏳ 기록 탭 리포트 목록
- ⏳ 리포트 상세 보기
- ⏳ 채팅방 이동 딥링크

### 제외 기능

- ❌ 이미지/파일 전송
- ❌ 푸시 알림
- ❌ 메시지 검색
- ❌ 프로필 수정
- ❌ 일기 직접 작성 (기획에서 제외)
